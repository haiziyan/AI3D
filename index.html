<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <title>AI 3D Studio - AI驱动的在线3D CAD建模工具 | 免费在线CAD设计</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        
        <!-- 基本SEO -->
        <meta name="application-name" content="AI 3D Studio">
        <meta name="description" content="AI 3D Studio是一款强大的AI驱动在线3D CAD建模工具，支持自然语言生成3D模型、参数化设计、STEP/STL导出。基于OpenCascade.js，完全免费，无需安装，浏览器即可使用。">
        <meta name="keywords" content="AI 3D建模,在线CAD,3D设计工具,参数化建模,OpenCAD,AI建模,3D打印,STEP导出,STL导出,免费CAD软件,在线3D设计,AI CAD,智能建模,OpenCascade">
        <meta name="author" content="AI 3D Studio">
        <meta name="robots" content="index, follow">
        <meta name="googlebot" content="index, follow">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://yourdomain.com/">
        <meta property="og:title" content="AI 3D Studio - AI驱动的在线3D CAD建模工具">
        <meta property="og:description" content="使用自然语言创建3D模型，支持参数化设计、STEP/STL导出。完全免费的在线CAD工具，无需安装。">
        <meta property="og:image" content="https://yourdomain.com/icon/CascadeStudioBanner-1257x519.png">
        <meta property="og:site_name" content="AI 3D Studio">
        <meta property="og:locale" content="zh_CN">
        
        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:url" content="https://yourdomain.com/">
        <meta name="twitter:title" content="AI 3D Studio - AI驱动的在线3D CAD建模工具">
        <meta name="twitter:description" content="使用自然语言创建3D模型，支持参数化设计、STEP/STL导出。完全免费的在线CAD工具。">
        <meta name="twitter:image" content="https://yourdomain.com/icon/CascadeStudioBanner-1257x519.png">
        
        <!-- 移动端优化 -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
        <meta name="theme-color" content="#2c3e50">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="AI 3D Studio">
        
        <!-- 搜索引擎验证（根据需要添加）-->
        <!-- <meta name="google-site-verification" content="your-verification-code"> -->
        <!-- <meta name="baidu-site-verification" content="your-verification-code"> -->
        
        <!-- Canonical URL -->
        <link rel="canonical" href="https://yourdomain.com/">
        
        <!-- 结构化数据 (JSON-LD) -->
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "SoftwareApplication",
          "name": "AI 3D Studio",
          "applicationCategory": "DesignApplication",
          "operatingSystem": "Web Browser",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
          },
          "description": "AI驱动的在线3D CAD建模工具，支持自然语言生成3D模型、参数化设计、STEP/STL导出",
          "softwareVersion": "1.0",
          "author": {
            "@type": "Organization",
            "name": "AI 3D Studio"
          },
          "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1000"
          },
          "screenshot": "https://yourdomain.com/icon/CascadeStudioScreenshot.png",
          "featureList": [
            "AI自然语言建模",
            "参数化设计",
            "STEP/STL/OBJ导出",
            "在线3D预览",
            "无需安装",
            "完全免费"
          ]
        }
        </script>

        <!-- Include these early and directly so they happen first -->
        <script>
            // Install AI 3D Studio as a Progressive Web App for Offline Access
            // This needs to be put before ANY HTTP Requests are made, so it can cache them.
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                    registration.update(); // Always update the registration for the latest assets
                }, function() {
                    console.log('Could not register AI 3D Studio for offline use!');
                });
            } else {
                console.log('Browser does not support offline access!');
            }

            // Begins loading the CAD Kernel Web Worker
            if (window.Worker) {
                var cascadeStudioWorker = new Worker('./js/CADWorker/CascadeStudioMainWorker.js');
                // Ping Pong Messages Back and Forth based on their registration in messageHandlers
                var messageHandlers = {};
                cascadeStudioWorker.onmessage = function (e) {
                    if(e.data.type in messageHandlers){
                        let response = messageHandlers[e.data.type](e.data.payload);
                        if (response) { cascadeStudioWorker.postMessage({ "type": e.data.type, payload: response }) };
                    }
                }
            }
        </script>

        <link rel='shortcut icon'      href='./icon/favicon.ico' type='image/x-icon' >
        <link rel="manifest"           href="./manifest.webmanifest">
        <link rel="apple-touch-icon"   href="./icon/apple-touch-icon.png">

        <!-- Supabase -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

        <script type="text/javascript" src="./node_modules/three/build/three.min.js"></script>
        <script type="text/javascript" src="./node_modules/three/examples/js/controls/DragControls.js"></script>
        <script type="text/javascript" src="./node_modules/three/examples/js/controls/OrbitControls.js"></script>
        <script type="text/javascript" src="./node_modules/three/examples/js/controls/TransformControls.js"></script>
        <script type="text/javascript" src="./node_modules/three/examples/js/exporters/STLExporter.js"></script>
        <script type="text/javascript" src="./node_modules/three/examples/js/exporters/OBJExporter.js"></script>

        <script type="text/javascript" src="./node_modules/tweakpane/dist/tweakpane.min.js"></script>

        <script type="text/javascript" src="./node_modules/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="./node_modules/golden-layout/dist/goldenlayout.min.js"></script>
        <link type="text/css" rel="stylesheet" href="./node_modules/golden-layout/src/css/goldenlayout-base.css" />
        <link type="text/css" rel="stylesheet" href="./node_modules/golden-layout/src/css/goldenlayout-dark-theme.css" />
        <link type="text/css" rel="stylesheet" href="./css/main.css" />

        <script type="text/javascript" src="./node_modules/rawflate/rawdeflate.js"></script>
        <script type="text/javascript" src="./node_modules/rawflate/rawinflate.js"></script>
        
        <!-- 配置和认证 -->
        <script type="text/javascript" src="./js/config.js"></script>
        <script type="text/javascript" src="./js/auth.js"></script>
        <script type="text/javascript" src="./js/aiGenerator.js"></script>
        
        <script type="text/javascript" src="./js/MainPage/CascadeViewHandles.js"></script>
        <script type="text/javascript" src="./js/MainPage/CascadeView.js"></script>
    </head>

    <body onload="initialize();" style="margin:0px; background-color:#1a1a1a;">
        <h1 hidden>AI 3D CAD Studio</h1>
        
        <!-- 顶部导航栏 -->
        <div id="topnav" class="topnav">
            <div class="nav-left">
                <a href="#" class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    <span>AI 3D CAD Studio</span>
                </a>
            </div>
            
            <div class="nav-center">
                <div class="menu-toggle" onclick="toggleMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-menu" id="navMenu">
                    <!-- 文件菜单 -->
                    <div class="menu-dropdown">
                        <button class="menu-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="13 2 13 9 20 9"/>
                            </svg>
                            文件
                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="createNewProject(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="12" y1="18" x2="12" y2="12"/>
                                    <line x1="9" y1="15" x2="15" y2="15"/>
                                </svg>
                                新建项目
                            </a>
                            <a href="#" onclick="loadProject(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                                打开文件
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="saveProject(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                保存项目
                                <span class="shortcut">Ctrl+S</span>
                            </a>
                            <a href="#" onclick="saveProjectAs(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                另存为
                            </a>
                        </div>
                    </div>
                    
                    <!-- 导出菜单 -->
                    <div class="menu-dropdown">
                        <button class="menu-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            导出
                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="threejsViewport.saveShapeSTEP(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                                STEP (.step)
                                <span class="format-desc">工业标准</span>
                            </a>
                            <a href="#" onclick="threejsViewport.saveShapeSTL(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                </svg>
                                STL (.stl)
                                <span class="format-desc">3D打印</span>
                            </a>
                            <a href="#" onclick="threejsViewport.saveShapeOBJ(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                </svg>
                                OBJ (.obj)
                                <span class="format-desc">通用格式</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- 导入菜单 -->
                    <div class="menu-dropdown">
                        <button class="menu-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            导入
                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                        <div class="dropdown-content">
                            <label for="files" class="dropdown-item-label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                                STEP/IGES (.step, .igs)
                                <input id="files" name="files" type="file" accept=".iges,.step,.igs,.stp,.stl,.obj" multiple style="display:none;" oninput="loadFiles();"/>
                            </label>
                            <label for="filesSTL" class="dropdown-item-label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                </svg>
                                STL (.stl)
                                <input id="filesSTL" type="file" accept=".stl" multiple style="display:none;" oninput="loadFiles('filesSTL');"/>
                            </label>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="clearExternalFiles(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"/>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                </svg>
                                清除所有导入
                            </a>
                        </div>
                    </div>
                    
                    <!-- 设置菜单 -->
                    <div class="menu-dropdown">
                        <button class="menu-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M23 12h-6m-6 0H1m18.2 5.2l-4.2-4.2m0-6l4.2-4.2"/>
                            </svg>
                            设置
                            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="toggleTheme(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="5"/>
                                    <line x1="12" y1="1" x2="12" y2="3"/>
                                    <line x1="12" y1="21" x2="12" y2="23"/>
                                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                    <line x1="1" y1="12" x2="3" y2="12"/>
                                    <line x1="21" y1="12" x2="23" y2="12"/>
                                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                </svg>
                                主题设置
                            </a>
                            <a href="#" onclick="showPreferences(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"/>
                                    <path d="M12 1v6m0 6v6"/>
                                </svg>
                                偏好设置
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="showAbout(); return false;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="16" x2="12" y2="12"/>
                                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                                </svg>
                                关于
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nav-right">
                <div id="userInfo"></div>
            </div>
        </div>

        <!-- 主应用区域 -->
        <div id="appbody" style="height:auto">
            <link data-name="vs/editor/editor.main" rel="stylesheet" href="./node_modules/monaco-editor/min/vs/editor/editor.main.css">
            <script>var require = { paths: { 'vs': 'node_modules/monaco-editor/min/vs' } };</script>
            <script type="text/javascript" src="./node_modules/monaco-editor/min/vs/loader.js"></script>
            <script type="text/javascript" src="./node_modules/monaco-editor/min/vs/editor/editor.main.nls.js"></script>
            <script type="text/javascript" src="./node_modules/monaco-editor/min/vs/editor/editor.main.js"></script>
            <script type="text/javascript" src="./js/MainPage/CascadeMain.js"></script>
        </div>

        <!-- 登录/注册模态框 -->
        <div id="authModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('authModal').style.display='none'">&times;</span>
                
                <!-- Tab导航 -->
                <div class="auth-tabs">
                    <button class="auth-tab-btn active" onclick="switchAuthTab('login')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                            <polyline points="10 17 15 12 10 7"/>
                            <line x1="15" y1="12" x2="3" y2="12"/>
                        </svg>
                        登录
                    </button>
                    <button class="auth-tab-btn" onclick="switchAuthTab('signup')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <line x1="20" y1="8" x2="20" y2="14"/>
                            <line x1="23" y1="11" x2="17" y2="11"/>
                        </svg>
                        注册
                    </button>
                </div>
                
                <!-- 登录表单 -->
                <div id="loginForm" class="auth-form-content active">
                    <h2>登录账户</h2>
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">邮箱</label>
                            <input type="email" id="loginEmail" required placeholder="请输入邮箱地址" />
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">密码</label>
                            <input type="password" id="loginPassword" required placeholder="请输入密码" />
                        </div>
                        <button type="submit" class="btn-primary">登录</button>
                    </form>
                </div>
                
                <!-- 注册表单 -->
                <div id="signupForm" class="auth-form-content">
                    <h2>创建账户</h2>
                    <form id="signupFormElement">
                        <div class="form-group">
                            <label for="signupEmail">邮箱</label>
                            <input type="email" id="signupEmail" required placeholder="请输入邮箱地址" />
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">密码</label>
                            <input type="password" id="signupPassword" required placeholder="至少6位字符" minlength="6" />
                        </div>
                        <div class="form-group">
                            <label for="signupPasswordConfirm">确认密码</label>
                            <input type="password" id="signupPasswordConfirm" required placeholder="再次输入密码" minlength="6" />
                        </div>
                        <button type="submit" class="btn-primary">注册</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 用户中心模态框 -->
        <div id="userCenterModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close" onclick="document.getElementById('userCenterModal').style.display='none'">&times;</span>
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    用户中心
                </h2>
                
                <!-- Tab导航 -->
                <div class="user-center-tabs">
                    <button class="tab-btn active" onclick="switchUserTab('info')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        个人信息
                    </button>
                    <button class="tab-btn" onclick="switchUserTab('credits')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        我的积分
                    </button>
                    <button class="tab-btn" onclick="switchUserTab('history')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        生成记录
                    </button>
                </div>
                
                <!-- Tab内容 -->
                <div class="user-center-content">
                    <!-- 个人信息Tab -->
                    <div id="tabInfo" class="tab-content active">
                        <div class="user-info-card">
                            <div class="user-avatar">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <div class="user-details">
                                <div class="user-detail-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                    <span class="detail-label">邮箱</span>
                                    <span class="detail-value" id="userCenterEmail">-</span>
                                </div>
                                <div class="user-detail-item">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    <span class="detail-label">注册时间</span>
                                    <span class="detail-value" id="userCreatedAt">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 积分Tab -->
                    <div id="tabCredits" class="tab-content">
                        <div class="credits-info">
                            <div class="credits-display">
                                <span class="credits-amount" id="creditsAmount">0</span>
                                <span class="credits-label">可用积分</span>
                            </div>
                            <button class="btn-recharge" onclick="alert('充值功能开发中...')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                                    <path d="M21 3v5h-5"/>
                                </svg>
                                充值积分
                            </button>
                        </div>
                    </div>
                    
                    <!-- 生成记录Tab -->
                    <div id="tabHistory" class="tab-content">
                        <div class="transaction-history">
                            <div id="transactionHistory" class="history-list">
                                <!-- 生成记录将动态加载 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 退出登录按钮（底部） -->
                <div class="user-center-footer">
                    <button class="btn-logout" onclick="authManager.signOut(); document.getElementById('userCenterModal').style.display='none'">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        退出登录
                    </button>
                </div>
            </div>
        </div>

        <script>
            // 初始化
            window.addEventListener('load', () => {
                // AI输入已移至左侧栏，不需要初始化顶部面板
            });

            // 切换移动端菜单
            function toggleMenu() {
                const menu = document.getElementById('navMenu');
                menu.classList.toggle('active');
            }
            
            // 移动端下拉菜单切换
            document.addEventListener('DOMContentLoaded', function() {
                const menuBtns = document.querySelectorAll('.menu-btn');
                menuBtns.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        if (window.innerWidth <= 768) {
                            e.stopPropagation();
                            const dropdown = this.parentElement;
                            const wasActive = dropdown.classList.contains('active');
                            
                            // 关闭所有下拉菜单
                            document.querySelectorAll('.menu-dropdown').forEach(d => {
                                d.classList.remove('active');
                            });
                            
                            // 切换当前菜单
                            if (!wasActive) {
                                dropdown.classList.add('active');
                            }
                        }
                    });
                });
            });
            
            // 新建项目
            function createNewProject() {
                if (confirm('确定要创建新项目吗？未保存的更改将丢失。')) {
                    window.location.reload();
                }
            }
            
            // 另存为
            function saveProjectAs() {
                file.handle = null;
                saveProject();
            }
            
            // 主题切换（占位函数）
            function toggleTheme() {
                alert('主题切换功能开发中...');
            }
            
            // 偏好设置（占位函数）
            function showPreferences() {
                alert('偏好设置功能开发中...');
            }
            
            // 关于（占位函数）
            function showAbout() {
                alert('AI 3D CAD Studio\n版本: 1.0.0\n基于 OpenCascade.js 构建的在线3D建模工具');
            }

            // 切换认证Tab（登录/注册）
            function switchAuthTab(tabName) {
                // 移除所有active类
                document.querySelectorAll('.auth-tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.auth-form-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 添加active类到当前tab
                event.currentTarget.classList.add('active');
                
                const formId = tabName + 'Form';
                const formContent = document.getElementById(formId);
                if (formContent) {
                    formContent.classList.add('active');
                }
            }

            // 切换用户中心Tab
            function switchUserTab(tabName) {
                // 移除所有active类
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 添加active类到当前tab
                const clickedBtn = event.currentTarget;
                clickedBtn.classList.add('active');
                
                const tabId = 'tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
                const tabContent = document.getElementById(tabId);
                if (tabContent) {
                    tabContent.classList.add('active');
                }
                
                // 如果切换到生成记录tab，加载数据
                if (tabName === 'history' && authManager) {
                    authManager.loadTransactionHistory();
                }
            }

            // 点击外部关闭模态框
            window.onclick = function(event) {
                const authModal = document.getElementById('authModal');
                const userCenterModal = document.getElementById('userCenterModal');
                if (event.target == authModal) {
                    authModal.style.display = 'none';
                }
                if (event.target == userCenterModal) {
                    userCenterModal.style.display = 'none';
                }
            }
        </script>
    </body>
</html>
